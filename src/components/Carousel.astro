---
import { Image } from 'astro:assets';
import { customGetCollection } from '@utils/customGetCollection';
import FormattedDate from '@components/FormattedDate.astro';

const blogCollection = await customGetCollection('blog', 'blog');
let posts = blogCollection.sort((a, b) => {
	// Sort by modifiedDate if available, otherwise fall back to pubDate
	const dateA = a.props.data.update ? new Date(a.props.data.update) : new Date(a.props.data.pubDate);
	const dateB = b.props.data.update ? new Date(b.props.data.update) : new Date(b.props.data.pubDate);
	// Sort in descending order (newest first)
	return dateB.valueOf() - dateA.valueOf();
});
// 限制只显示最新的6篇文章
posts = posts.slice(0, 6);
---

<div
	class="flex w-full flex-col items-center rounded-xl border-4 border-semantic-on-surface-variant text-semantic-on-surface-variant"
>
	<div class="flex w-full items-center justify-center gap-4 pt-2">
		<span class="text-xs tracking-[.4rem] text-semantic-on-background">recent posts</span>
		<a href="/blog" class="rounded-full bg-semantic-surface-variant/80 px-3 py-1 text-xs text-semantic-on-surface-variant transition-all hover:bg-semantic-surface-variant hover:text-semantic-on-surface-variant/90">Read More</a>
	</div>
	<span class="pb-2 text-xs text-semantic-on-background/70">本水最新的6篇博客文章</span>
	<div class="w-full p-4">
		<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
			{
				posts.map((post) => (
					post.props.data.heroImage && (
						<div class="flex flex-col rounded-lg overflow-hidden border border-semantic-on-surface-variant/20 hover:shadow-md transition-shadow">
							<a href={post.params.htmlSlug} class="group">
								<div class="relative aspect-video overflow-hidden">
									<Image
										class="w-full h-full object-cover transition-transform group-hover:scale-105"
										src={post.props.data.heroImage}
										alt={post.props.data.heroAlt || ''}
									/>
								</div>
								<div class="p-3">
									<h3 class="text-base font-semibold line-clamp-2 group-hover:text-semantic-primary">
										{post.props.data.title}
									</h3>
									<div class="text-xs text-semantic-on-background/60 mt-2">
										<FormattedDate
											date={post.props.data.update ? new Date(post.props.data.update) : new Date(post.props.data.pubDate)}
										/>
									</div>
								</div>
							</a>
						</div>
					)
				))
			}
		</div>
	</div>
</div>
